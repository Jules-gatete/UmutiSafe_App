import{a as i,j as e,k as L,X as C,L as u,m as T,a3 as _,I as U,a4 as A}from"./vendor_react-Dgc4Ukrk.js";import{S as d}from"./StatCard-BFpVXPPm.js";import{b as p}from"./index-BKRpE7vh.js";import{R as j,B as R,C as S,X as E,Y as P,T as b,L as I,a as $,P as F,b as H,c as B}from"./vendor_recharts-CXZR4uKX.js";import"./vendor_misc-CL3qle1O.js";import"./vendor_axios-ngrFHoWO.js";function J(){const[a,f]=i.useState(null),[n,y]=i.useState([]),[N,x]=i.useState(!0);i.useEffect(()=>{h()},[]);async function h(){try{x(!0);const[s,t]=await Promise.all([p.getStats(),p.getPendingUsers()]);s&&s.success&&f(s.data),t&&t.success&&y(t.data)}catch(s){console.error("Error fetching dashboard data:",s)}finally{x(!1)}}if(N)return e.jsx("div",{className:"p-4 lg:p-8 flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-blue"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading dashboard..."})]})});if(!a)return e.jsx("div",{className:"p-4 lg:p-8 flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Failed to load dashboard data"})});const c=a.risk_distribution||{LOW:0,MEDIUM:0,HIGH:0},g=[{name:"Low Risk",value:c.LOW||0,color:"#2E8B57"},{name:"Medium Risk",value:c.MEDIUM||0,color:"#F59E0B"},{name:"High Risk",value:c.HIGH||0,color:"#E03E2D"}],v=(s=>{const t=[],r=new Date;for(let l=s-1;l>=0;l--){const m=new Date(r.getFullYear(),r.getMonth()-l,1),D=m.toLocaleString("default",{month:"short"});t.push({label:D,year:m.getFullYear(),monthIndex:m.getMonth()})}return t})(3),k=Array.isArray(a.monthly_trend)?a.monthly_trend:[],w=v.map(s=>{const t=k.find(r=>r?new Date(r.month||r.label||"").toLocaleString("default",{month:"short"})===s.label||r.month===`${s.year}-${String(s.monthIndex+1).padStart(2,"0")}`:!1);return{month:s.label,count:t&&t.count||0}}),o=Array.isArray(a.top_medicines)?a.top_medicines:[],M=(()=>{const s=a.completed_this_month||0,t=a.previous_month||0;if(!t)return"";const r=(s-t)/Math.max(1,t)*100;return`${r>=0?"+":""}${r.toFixed(0)}% this month`})();return e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Monitor system-wide medicine disposal activities"}),e.jsx("button",{onClick:h,className:"btn-outline ml-auto",children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(d,{icon:L,label:"Total Users",value:a.total_users||0,color:"blue"}),e.jsx(d,{icon:C,label:"Community Health Workers",value:a.total_chws||0,color:"green"}),e.jsx(u,{to:"/admin/disposals",className:"block",children:e.jsx(d,{icon:T,label:"Total Disposals",value:a.total_disposals||0,color:"blue"})}),e.jsx(d,{icon:_,label:"This Month",value:a.completed_this_month||0,color:"green",trend:M})]}),n.length>0&&e.jsxs("div",{className:"card mb-8 border-l-4 border-warning",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-warning/10 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pending User Approvals"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[n.length," user",n.length!==1?"s":""," waiting for approval"]})]})]}),e.jsxs(u,{to:"/admin/users",className:"btn-primary text-sm",children:[e.jsx(A,{className:"w-4 h-4"}),"Manage Users"]})]}),e.jsxs("div",{className:"space-y-2",children:[n.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.email})]}),e.jsx("span",{className:"px-3 py-1 bg-warning/20 text-warning rounded-full text-xs font-medium",children:s.role.toUpperCase()})]},s.id)),n.length>3&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center pt-2",children:["+",n.length-3," more pending approval"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Monthly Disposal Trend"}),e.jsx(j,{width:"100%",height:300,children:e.jsxs(R,{data:w,children:[e.jsx(S,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"month"}),e.jsx(P,{}),e.jsx(b,{}),e.jsx(I,{}),e.jsx($,{dataKey:"count",fill:"#0B6FA7",name:"Disposals"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Risk Level Distribution"}),e.jsx(j,{width:"100%",height:300,children:e.jsxs(F,{children:[e.jsx(H,{data:g,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:t})=>`${s}: ${(t*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:g.map((s,t)=>e.jsx(B,{fill:s.color},`cell-${t}`))}),e.jsx(b,{})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Top Disposed Medicines"}),e.jsx("div",{className:"space-y-3",children:o.length===0?e.jsx("div",{className:"p-4 text-gray-600",children:"No data available"}):o.map((s,t)=>{const r=o[0]?.count||1,l=s.count/r*100;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-blue text-white flex items-center justify-center font-bold text-sm",children:t+1}),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-48 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-green h-2 rounded-full",style:{width:`${l}%`}})}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 w-16 text-right",children:s.count})]})]},t)})})]})]})}export{J as default};
