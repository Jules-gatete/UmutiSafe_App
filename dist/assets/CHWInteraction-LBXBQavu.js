import{f as A,a as l,j as e,G as D,y as E,x as M,_ as F}from"./vendor_react-Dgc4Ukrk.js";import{I as x}from"./Input-YxyfnI9a.js";import{T as _}from"./Textarea-DcvVLu-U.js";import{S as $}from"./Select-CSK-mc_6.js";import{T as O}from"./Table-BvijVr8l.js";import{S as K}from"./SearchBar-nub_LemY.js";import{c as B,p as j}from"./index-BKRpE7vh.js";import"./vendor_misc-CL3qle1O.js";import"./vendor_axios-ngrFHoWO.js";function te(){const g=A().state||{},[d,v]=l.useState(""),[m,C]=l.useState([]),[h,w]=l.useState([]),[S,b]=l.useState(!0),[f,P]=l.useState(""),i=JSON.parse(localStorage.getItem("user")||"{}");l.useEffect(()=>{o();const a=setInterval(()=>{o()},1e4),t=()=>{document.hidden||o()};return document.addEventListener("visibilitychange",t),()=>{clearInterval(a),document.removeEventListener("visibilitychange",t)}},[]);const o=async()=>{try{b(!0);const[a,t]=await Promise.all([B.getAvailable(),j.getAll()]);a.success&&C(a.data),t.success&&w(t.data)}catch(a){console.error("Error fetching data:",a),P("Failed to load CHW data")}finally{b(!1)}},y=l.useMemo(()=>{let a=m;if(i.sector&&(a=m.filter(r=>r.sector&&r.sector.toLowerCase()===i.sector.toLowerCase())),!d)return a;const t=d.toLowerCase();return a.filter(r=>(r.name||"").toLowerCase().includes(t)||(r.sector||"").toLowerCase().includes(t)||(r.coverageArea||"").toLowerCase().includes(t)||(r.phone||"").toLowerCase().includes(t))},[d,m,i.sector]),[n,u]=l.useState(null),[s,p]=l.useState({medicineName:g.medicineName||"",disposalGuidance:g.disposalGuidance||"",reason:"",pickupLocation:"",preferredTime:"",consent:!1}),[L,N]=l.useState(!1),[Q,k]=l.useState(!1),H=[{value:"expired",label:"Medicine Expired"},{value:"no_longer_needed",label:"No Longer Needed"},{value:"completed_treatment",label:"Completed Treatment"},{value:"adverse_reaction",label:"Adverse Reaction"},{value:"other",label:"Other"}],W=a=>{u(a)},c=a=>{const{name:t,value:r,type:I,checked:R}=a.target;p({...s,[t]:I==="checkbox"?R:r})},q=async a=>{if(a.preventDefault(),!n){alert("Please select a CHW first.");return}if(!s.consent){alert("Please provide consent to share your information.");return}const t={chwId:n.id,medicineName:s.medicineName,disposalGuidance:s.disposalGuidance,reason:s.reason,pickupLocation:s.pickupLocation,preferredTime:s.preferredTime,consentGiven:s.consent};try{k(!0),(await j.create(t)).success&&(N(!0),setTimeout(()=>N(!1),5e3),p({medicineName:"",disposalGuidance:"",reason:"",pickupLocation:"",preferredTime:"",consent:!1}),u(null),o())}catch(r){console.error("Error submitting pickup request:",r),alert("Failed to submit pickup request. Please try again.")}finally{k(!1)}p({medicineName:"",disposalGuidance:"",reason:"",pickupLocation:"",preferredTime:"",consent:!1}),u(null)},T=l.useMemo(()=>h.map(a=>({...a,chwName:a.chw?.name||"Not assigned",createdAt:new Date(a.createdAt).toLocaleDateString()})),[h]),G=[{key:"medicineName",label:"Medicine",sortable:!0},{key:"chwName",label:"CHW",sortable:!0},{key:"status",label:"Status",sortable:!0,render:a=>e.jsx("span",{className:`badge badge-${a==="completed"?"success":a==="scheduled"?"info":a==="pending"?"warning":"danger"}`,children:a.toUpperCase()})},{key:"createdAt",label:"Requested",sortable:!0}];return S?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading CHW data..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Request CHW Pickup"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Connect with Community Health Workers for safe medicine disposal"}),f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:f}),L&&e.jsxs("div",{className:"mb-6 p-4 bg-green-100 dark:bg-green-900 dark:bg-opacity-30 border-l-4 border-green-500 rounded-lg flex items-center gap-3",children:[e.jsx(D,{className:"w-6 h-6 text-green-600 dark:text-green-400"}),e.jsx("p",{className:"text-green-800 dark:text-green-200 font-medium",children:"Pickup request submitted successfully! The CHW will contact you soon."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Community Health Workers in Your Sector"}),i.sector&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Showing CHWs from ",e.jsx("span",{className:"font-semibold text-primary-blue dark:text-accent-cta",children:i.sector})," sector"]}),!i.sector&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-300",children:"Please update your sector in your profile to see CHWs in your area."})}),e.jsx("div",{className:"mb-4 max-w-md",children:e.jsx(K,{onSearch:a=>v(a),placeholder:"Search CHWs by name, sector or coverage area..."})}),e.jsx("div",{className:"space-y-3",children:y.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:i.sector?`No CHWs available in ${i.sector} sector at the moment.`:"Please set your sector in your profile to see available CHWs."})}):y.map(a=>e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-all ${n?.id===a.id?"border-primary-blue dark:border-accent-cta bg-blue-50 dark:bg-blue-900 dark:bg-opacity-20":"border-gray-200 dark:border-gray-700 hover:border-primary-blue dark:hover:border-accent-cta"}`,onClick:()=>W(a),children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-green text-white flex items-center justify-center font-semibold flex-shrink-0",children:a.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4"}),a.coverageArea]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"}),a.phone]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:`badge ${a.availability==="available"?"badge-success":"badge-warning"}`,children:a.availability}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),a.rating]})]})]})]})})},a.id))})]}),e.jsxs("form",{onSubmit:q,className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Pickup Request Form"}),n?e.jsx("div",{className:"mb-4 p-3 bg-green-50 dark:bg-green-900 dark:bg-opacity-20 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Selected CHW: ",e.jsx("span",{className:"font-semibold",children:n.name})]})}):e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900 dark:bg-opacity-20 rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Please select a CHW from the list"})}),e.jsx(x,{label:"Medicine Name",id:"medicineName",name:"medicineName",value:s.medicineName,onChange:c,placeholder:"e.g., Paracetamol (Panadol)",required:!0}),e.jsx(_,{label:"Disposal Guidance (Pre-filled)",id:"disposalGuidance",name:"disposalGuidance",value:s.disposalGuidance,onChange:c,rows:3,placeholder:"Disposal instructions will appear here after classification"}),e.jsx($,{label:"Reason for Disposal",id:"reason",name:"reason",value:s.reason,onChange:c,options:H,required:!0}),e.jsx(x,{label:"Pickup Location",id:"pickupLocation",name:"pickupLocation",value:s.pickupLocation,onChange:c,placeholder:"e.g., KG 123 St, Remera, Kigali",required:!0}),e.jsx(x,{label:"Preferred Pickup Time",id:"preferredTime",name:"preferredTime",type:"datetime-local",value:s.preferredTime,onChange:c,required:!0}),e.jsx("div",{className:"mb-6",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"consent",checked:s.consent,onChange:c,className:"mt-1 w-5 h-5 text-primary-blue focus:ring-accent-cta rounded",required:!0}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"I consent to share my contact information and location with the selected Community Health Worker for the purpose of medicine pickup and disposal."})]})}),e.jsx("button",{type:"submit",disabled:!n||!s.consent,className:"btn-primary w-full",children:"Submit Pickup Request"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"My Pickup Requests"}),e.jsx(O,{columns:G,data:T})]})]})}export{te as default};
